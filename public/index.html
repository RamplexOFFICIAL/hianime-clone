<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aniwatch Anime Viewer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <style>
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .anime-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .anime-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .anime-card .details {
      padding: 15px;
    }

    .genre-list {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 10px;
    }

    .genre-item {
      background-color: #f0f0f0;
      padding: 5px 10px;
      border-radius: 5px;
    }


    .top-anime-charts {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .top-anime-chart {
      width: calc(33.33% - 10px);
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1 class="text-3xl font-bold mb-4 text-center">Aniwatch Anime Viewer</h1>

    <div class="mb-4">
      <input type="text" v-model="searchQuery" placeholder="Search for anime..." class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:ring-blue-300">
    </div>

    <div v-show="loading" class="text-center">
      Loading...
    </div>

    <div v-show="!loading">
      <section v-if="searchQuery" class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Search Results for "{{ searchQuery }}"</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in searchResults.animes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Type: {{ anime.type }}</p>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>

      <section v-else class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Latest Episodes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in latestEpisodeAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Type: {{ anime.type }}</p>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Spotlight Animes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in spotlightAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>{{ anime.description }}</p>
              <div class="genre-list">
                <span v-for="genre in anime.otherInfo" :key="genre" class="genre-item">
                  {{ genre }}
                </span>
              </div>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Top 10 Animes</h2>
        <div class="top-anime-charts">
          <div class="top-anime-chart" v-for="(chart, index) in Object.keys(top10Animes)" :key="index">
            <h3 class="text-xl font-bold mt-2 mb-2">{{ chart }}</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in top10Animes[chart]" :key="index">
              <div class="anime-card">
                <img :src="anime.poster" alt="Anime Poster">
                <div class="details">
                  <h3 class="text-xl font-bold">{{ anime.name }}</h3>
                  <p>Rank: {{ anime.rank }}</p>
                  <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Top Aired & Upcoming</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h3 class="text-xl font-bold mb-2">Top Aired</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in topAiringAnimes" :key="index">
              <div class="anime-card">
                <img :src="anime.poster" alt="Anime Poster">
                <div class="details">
                  <h3 class="text-xl font-bold">{{ anime.name }}</h3>
                </div>
              </div>
            </div>
          </div>
          <div>
            <h3 class="text-xl font-bold mb-2">Top Upcoming</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in topUpcomingAnimes" :key="index">
              <div class="anime-card">
                <img :src="anime.poster" alt="Anime Poster">
                <div class="details">
                  <h3 class="text-xl font-bold">{{ anime.name }}</h3>
                  <p>Duration: {{ anime.duration }}</p>
                  <p>Type: {{ anime.type }}</p>
                  <p>Rating: {{ anime.rating }}</p>
                  <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Trending Animes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in trendingAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Rank: {{ anime.rank }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Most Popular Animes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in mostPopularAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Type: {{ anime.type }}</p>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Most Favorite Animes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in mostFavoriteAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Type: {{ anime.type }}</p>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-2">Latest Completed Animes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" v-for="(anime, index) in latestCompletedAnimes" :key="index">
          <div class="anime-card">
            <img :src="anime.poster" alt="Anime Poster">
            <div class="details">
              <h3 class="text-xl font-bold">{{ anime.name }}</h3>
              <p>Type: {{ anime.type }}</p>
              <p>Episodes: Sub - {{ anime.episodes.sub }}, Dub - {{ anime.episodes.dub }}</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        loading: true,
        genres: [],
        latestEpisodeAnimes: [],
        spotlightAnimes: [],
        top10Animes: {
          today: [],
          month: [],
          week: []
        },
        topAiringAnimes: [],
        topUpcomingAnimes: [],
        trendingAnimes: [],
        mostPopularAnimes: [],
        mostFavoriteAnimes: [],
        latestCompletedAnimes: [],
        searchQuery: '',
        searchResults: {
          animes: [],
          currentPage: 1,
          totalPages: 1,
          hasNextPage: false,
          searchQuery: '',
          searchFilters: {}
        }
      },
      mounted() {
        this.fetchData();
      },
      watch: {
        searchQuery: {
          handler: async function(newQuery) {
            if (newQuery) {
              this.loading = true;
              try {
                const response = await fetch(`/api/v2/hianime/search?q=${newQuery}`);
                const data = await response.json();
                console.log(data);
                this.searchResults = data.data;
              } catch (error) {
                console.error('Error fetching search results:', error);
              } finally {
                this.loading = false;
              }
            } else {
              this.searchResults = {
                animes: [],
                currentPage: 1,
                totalPages: 1,
                hasNextPage: false,
                searchQuery: '',
                searchFilters: {}
              };
            }
          },
          // Immediate execution of the handler when the component is mounted
          immediate: true
        }
      },
      methods: {
        async fetchData() {
          try {
            const response = await fetch('/api/v2/hianime/home');
            const data = await response.json();
            console.log(data);

            if (data.success) {
              this.genres = data.data.genres;
              this.latestEpisodeAnimes = data.data.latestEpisodeAnimes;
              this.spotlightAnimes = data.data.spotlightAnimes;
              this.top10Animes.today = data.data.top10Animes.today;
              this.top10Animes.month = data.data.top10Animes.month;
              this.top10Animes.week = data.data.top10Animes.week;
              this.topAiringAnimes = data.data.topAiringAnimes;
              this.topUpcomingAnimes = data.data.topUpcomingAnimes;
              this.trendingAnimes = data.data.trendingAnimes;
              this.mostPopularAnimes = data.data.mostPopularAnimes;
              this.mostFavoriteAnimes = data.data.mostFavoriteAnimes;
              this.latestCompletedAnimes = data.data.latestCompletedAnimes;
            }
          } catch (error) {
            console.error('Error fetching data:', error);
          } finally {
            this.loading = false;
          }
        }
      }
    });
  </script>
</body>
</html>
